# 某大创项目设计简要

目的：远程亮灯、远程监视

设计：网页操作，通过服务器传到

模块：

  上层：服务器、网页

    动态网页：按钮s：

      开灯关灯，查看图片

      灯可以做多几个；图片隔一段时间自己更新

      外观不要太low

    服务器：

      开两个端口：分别给http和tcp，二者隔离

      类似中转站

  下层：硬件从略

通讯格式：

  ·以“数据包”为单位

  ·一帧数据包，分为“包头”、“包身”

  ·包头4个字节

    1 		终端号（连同一个服务器端口，有多个终端，分别有一个ID号，最多255个终端）

    2、3	包长度（包括包头）

    4	  	包类型

  ·包身是具体的数据

  ·不做包尾
  

  ·包类型：

    控制（定为0xff， -1）

    数据（一份数据可分多个包发，开始、结束分别定为0xfe， -2； 0xfc， -3）


  ·包长度：

    包括包头这4个字节

    是short int类型（不是字符串）

    小段模式


  ·控制类包：

    控制开关灯：灯号(0~255)、开(1)还是关(0)

    ·简例：

      服务器发给0号终端，控制这个终端的1号灯开：

        0x00    0x00    0x06    0xff    0x01    0x01

      |-------------包头-------------|------包身-----|

      |--0号--|------长度------|-类型-|--灯号--|-开灯-|

        ·注：以后可以尝试：从一个终端发上去——控制另一个终端


  ·数据类包：

    主要是终端传上去的图片信号，暂时传jpeg格式数据流

    开始包是0xfe, 结束包是0xfc

  ·简例：

    从0号终端发上去的jpeg流，分n多个包发：前n-1个包“类型”都填0xfe

    ·第一个包：

      0x00    0xff    0xff    0xfe    0xff    0xd8    0xxx    0xxx    ...

      |-------------包头------------|------------包身---------------- ...

      |--0号--|--长度(65535)--|-开始-|-----------JPEG流--------------- ...

    ·第n个包

      0x00    0x00    0x08    0xfc    0xxx    0xxx    0xff    0xd9

      |-------------包头------------|-------------包身--------------|

      |--0号--|-----长度------|-结束-|---------剩下的JPEG流----------|
